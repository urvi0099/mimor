<ion-content [fullscreen]="true">
  <mat-toolbar class="mim-header-toolbar">
    <a href="https://mimor.com.au" class="mim-main-logo mim-main-logo-orig">
      <img src="assets/img/logoNew.png" class="logo" alt="">
    </a>
    <div class="switch-role">
      <button class="logout-btn" aria-label="logoutbut" (click)="rolesService.logout()">
          <span class="icon"></span><span class="logout">Log Out</span>
      </button>
      <select class="switch-role-select" *ngIf="rolesService.getRoles().length > 1" (change)="rolesService.selectRole($event.target.value)">
        <option *ngFor="let role of rolesService.getRoles()" [value]="role.name">{{role.displayName}}</option>
      </select>
    </div>
  </mat-toolbar>
  <div class="flex-page">
    <div class="form-wrapper profile-form-wrapper">
      <form class="register-form" [formGroup]="profileForm" (ngSubmit)="edit()">
        <div ng-hide="pageLoading" class="login-block" layout="column">
          <h4 class="login-block-header mim-uppercase">Edit my personal profile</h4>
          <div class="login-fields">
            <div class="login-field mat-input">
              <label ng-if="!existingEmail">Full Name</label>
              <input matInput type="text" placeholder="Full Name" formControlName="name">
              <div
                *ngIf="(profileForm.submitted || profileForm.controls.name.touched && profileForm.controls.name.errors) && !existingEmail"
                class="form-validation-wrap">
                <div class="form-val-note-wrap">
                  <span class="form-val-input" *ngIf="profileForm.controls.email.errors.required">Tell us your full
                    name.</span>
                </div>
              </div>
            </div>
            <div class="login-field mat-input">
              <label>Company Name</label>
              <input matInput type="text" placeholder="Company Name" formControlName="company">
              <div
                *ngIf="(profileForm.submitted || profileForm.controls.company.touched && profileForm.controls.company.errors) && !existingEmail"
                class="form-validation-wrap">
                <div class="form-val-note-wrap">
                  <span class="form-val-input" *ngIf="profileForm.controls.company.errors.required">Tell us your company
                    name.</span>
                </div>
              </div>
            </div>
            <div class="login-field mat-input">
              <label>E-mail</label>
              <input matInput ng-blur="getRoleEmail()" type="email" placeholder="E-mail"
                name="email" formControlName="email">
              <div
                *ngIf="profileForm.submitted || profileForm.controls.email.touched && profileForm.controls.email.errors || existingEmail"
                class="form-validation-wrap">
                <div class="form-val-note-wrap">
                  <span class="form-val-input" *ngIf="profileForm.controls.email.errors.required">Tell us your
                    email.</span>
                  <span class="form-val-input" *ngIf="profileForm.controls.email.errors.pattern">This is not a valid
                    email.</span>
                  <!-- <div class="email-check" ng-if="existingEmail && form.email.$valid">
                    <span class="another-role-novalid">{{existingEmail}}</span>
                  </div> -->
                </div>
              </div>
            </div>
            <div class="login-field mat-input">
              <label class="md-block">Contact Number</label>
              <input matInput placeholder="Contact Number" type="tel" restrict="reject" limit="false"
                mask="00 0000 000 000 || 00 0000 0000 || 0000 0000 || 0 000 000 0000" validate="false" name="phone" (keypress)="enterKey($event)" ng-change="editPhone()"
                formControlName="phone">
              <div
                *ngIf="profileForm.submitted || profileForm.controls.phone.touched && profileForm.controls.phone.errors"
                class="form-validation-wrap">
                <div class="form-val-note-wrap">
                  <span class="form-val-input" *ngIf="profileForm.controls.phone.errors.required">Please enter your
                    phone number.</span>
                  <span class="form-val-input" *ngIf="profileForm.controls.phone.errors.pattern">Please enter a correct
                    phone.</span>
                </div>
              </div>
            </div>
            <div class="login-field mat-input">
              <label class="md-block">Password</label>
              <input matInput type="password" placeholder="*************" name="password" minlength="6"
                formControlName="password">
              <div
                *ngIf="profileForm.submitted || profileForm.controls.password.touched && profileForm.controls.password.errors"
                class="form-validation-wrap">
                <div class="form-val-note-wrap">
                  <span class="form-val-input" *ngIf="profileForm.controls.password.errors.required">Tell us your
                    password.</span>
                  <span class="form-val-input" *ngIf="profileForm.controls.password.errors.minlength">Password can't be
                    shorter than 6 characters.</span>
                </div>
              </div>
            </div>
            <div class="login-field mat-input">
              <label class="md-block">Confirm Password</label>
              <input matInput type="password" placeholder="*************" name="confirmPassword" minlength="6"
                formControlName="confirm" pattern="{{ profileForm.controls.password.value }}">
              <div
                *ngIf="profileForm.submitted || profileForm.controls.confirm.touched && profileForm.controls.confirm.errors"
                class="form-validation-wrap">
                <div class="form-val-note-wrap">
                  <span class="form-val-input" *ngIf="profileForm.controls.confirm.errors.required">Confirm your
                    password.</span>
                  <span class="form-val-input" *ngIf="profileForm.controls.confirm.errors.pattern">Passwords does not
                    match.</span>
                </div>
              </div>
            </div>
          </div>
          <div class="login-buttons">
            <button mat-button class="back-btn" type="reset" (click)="back()">
              <mat-icon aria-hidden="false" aria-label="back">keyboard_backspace</mat-icon> Back
            </button>
            <button mat-button type="submit" class="submit-btn"
              [disabled]="loading || profileForm.valid"
              aria-label="description">{{buttonText}}</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</ion-content>
